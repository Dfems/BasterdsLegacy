import { useContext } from 'react'

import { I18nContext } from './context'
import type { TranslationKey, UseTranslationReturnType } from './types'

/**
 * Hook per accedere alle traduzioni
 * Fornisce accesso type-safe alle traduzioni con lazy loading
 */
export const useTranslation = (): UseTranslationReturnType => {
  const context = useContext(I18nContext)

  if (!context) {
    throw new Error("useTranslation deve essere usato all'interno di I18nProvider")
  }

  const { language, setLanguage, translations, isLoading } = context

  // Ottieni le traduzioni per la lingua corrente
  const currentTranslations = translations[language]

  // Fallback a inglese se la lingua corrente non Ã¨ caricata
  const fallbackTranslations = translations.en

  // Se non abbiamo traduzioni, crea un oggetto vuoto con la struttura corretta
  const emptyTranslations: TranslationKey = {
    common: {
      appName: '',
      login: '',
      logout: '',
      username: '',
      password: '',
      name: '',
      email: '',
      cancel: '',
      submit: '',
      save: '',
      delete: '',
      edit: '',
      add: '',
      remove: '',
      search: '',
      loading: '',
      error: '',
      success: '',
      confirm: '',
      refresh: '',
      upload: '',
      uploadImage: '',
      download: '',
      status: '',
      modpack: '',
      created: '',
      size: '',
      actions: '',
      id: '',
    },
    navigation: {
      home: '',
      dashboard: '',
      console: '',
      settings: '',
      files: '',
      backups: '',
      whitelist: '',
      modpack: '',
      users: '',
      server: '',
      storage: '',
      gameplay: '',
    },
    home: {
      title: '',
      welcomePart: '',
      instructions: '',
      configBtn: '',
      launcherBtn: '',
      donateBtn: '',
      footer: '',
      loggedIn: {
        welcomeBack: '',
        serverOverview: '',
        quickActions: '',
        systemInfo: '',
        downloadSection: '',
        cpu: '',
        memory: '',
        uptime: '',
        goToDashboard: '',
        goToConsole: '',
        goToFiles: '',
        serverRunning: '',
        serverStopped: '',
        lastRestart: '',
      },
    },
    auth: {
      loginTitle: '',
      passwordLabel: '',
      passwordIncorrect: '',
      usernameLabel: '',
      loginButton: '',
    },
    modal: {
      title: '',
      nameLabel: '',
      namePlaceholder: '',
      usernameLabel: '',
      usernamePlaceholder: '',
      submitBtn: '',
      cancelBtn: '',
      error: '',
    },
    server: {
      commandLabel: '',
      consoleTitle: '',
      backToHome: '',
      consoleLoginMessage: '',
      serverStatus: '',
      running: '',
      stopped: '',
      start: '',
      stop: '',
      restart: '',
      clear: '',
      send: '',
      startingMessage: '',
      stoppingMessage: '',
      restartingMessage: '',
      powerError: '',
    },
    dashboard: {
      title: '',
      state: '',
      cpu: '',
      memory: '',
      uptime: '',
      actions: '',
      start: '',
      stop: '',
      restart: '',
      running: '',
      stopped: '',
      crashed: '',
      unknown: '',
      operationStarted: '',
      operationError: '',
      systemMemory: '',
      diskStorage: '',
      tps: '',
      tickTime: '',
      playersOnline: '',
      processMemory: '',
      used: '',
      free: '',
      total: '',
      utilized: '',
      utilized_masculine: '',
      notAvailable: '',
      checkingSpace: '',
      perfect: '',
      good: '',
      acceptable: '',
      slow: '',
      online: '',
      offline: '',
      rconRequired: '',
      enableRcon: '',
      rconEnabled: '',
      rconEnableError: '',
      restartRequired: '',
      restartServer: '',
    },
    files: {
      title: '',
      up: '',
      refresh: '',
      loading: '',
      loadError: '',
      noItems: '',
      folder: '',
      rename: '',
      delete: '',
      newName: '',
      confirmDelete: '',
      name: '',
      type: '',
      size: '',
      modified: '',
      actions: '',
      upload: '',
    },
    backups: {
      title: '',
      create: '',
      restore: '',
      download: '',
      delete: '',
      confirmDelete: '',
      creating: '',
      restoring: '',
      noBackups: '',
      schedule: {
        title: '',
        enabled: '',
        disabled: '',
        frequency: '',
        mode: '',
        time: '',
        day: '',
        status: '',
        nextRun: '',
        lastRun: '',
        configuration: '',
        presets: '',
        custom: '',
        enable: '',
        disable: '',
        save: '',
        preset: {
          disabled: '',
          daily_3am: '',
          daily_2am: '',
          every_2_days: '',
          every_3_days: '',
          weekly_monday: '',
          weekly_sunday: '',
          triple_daily: '',
        },
        frequency_options: {
          daily: '',
          every_2_days: '',
          every_3_days: '',
          weekly: '',
          custom: '',
        },
        mode_options: {
          full: '',
          world: '',
        },
        day_options: {
          0: '',
          1: '',
          2: '',
          3: '',
          4: '',
          5: '',
          6: '',
        },
        help: {
          frequency: '',
          mode: '',
          time: '',
          day: '',
          custom: '',
        },
        validation: {
          timeRequired: '',
          timeInvalid: '',
          dayRequired: '',
          cronRequired: '',
          cronInvalid: '',
        },
        messages: {
          loading: '',
          updateSuccess: '',
          updateError: '',
          loadError: '',
        },
      },
    },
    settings: {
      title: '',
      save: '',
      reset: '',
      serverProperties: '',
      worldSettings: '',
      difficulty: '',
      gamemode: '',
      maxPlayers: '',
      loading: '',
      errorLoad: '',
      tabs: {
        overview: { title: '', description: '' },
        environment: { title: '', description: '' },
        ui: { title: '', description: '' },
        server: { title: '', description: '' },
        advanced: { title: '', description: '' },
      },
      environment: {
        title: '',
        description: '',
        javaBin: {
          label: '',
          description: '',
          placeholder: '',
        },
        mcDir: {
          label: '',
          description: '',
          placeholder: '',
        },
        backupDir: {
          label: '',
          description: '',
          placeholder: '',
        },
        rcon: {
          title: '',
          enabled: '',
          host: {
            label: '',
            placeholder: '',
          },
          port: {
            label: '',
            placeholder: '',
          },
          password: {
            label: '',
            placeholder: '',
          },
        },
        logging: {
          title: '',
          description: '',
          level: {
            label: '',
            description: '',
            trace: '',
            debug: '',
            info: '',
            warn: '',
            error: '',
            fatal: '',
          },
          levels: {
            label: '',
            description: '',
            all: '',
            trace: '',
            debug: '',
            info: '',
            warn: '',
            error: '',
            fatal: '',
          },
          dir: {
            label: '',
            description: '',
            placeholder: '',
          },
          fileEnabled: {
            label: '',
            description: '',
          },
          retentionDays: {
            label: '',
            description: '',
            placeholder: '',
          },
          maxFiles: {
            label: '',
            description: '',
            placeholder: '',
          },
        },
        success: '',
        error: '',
        validationError: '',
      },
      backgroundRotation: {
        title: '',
        description: '',
        toggle: '',
        secondsLabel: '',
        current: '',
      },
      sftp: {
        title: '',
        description: '',
        ssh: '',
        user: '',
      },
      theme: {
        title: '',
        description: '',
        system: '',
        dark: '',
        light: '',
        current: '',
      },
      buttons: {
        title: '',
        description: '',
        launcher: {
          title: '',
          visible: '',
          path: { label: '', placeholder: '' },
        },
        config: {
          title: '',
          visible: '',
          path: { label: '', placeholder: '' },
        },
        modpack: {
          title: '',
          name: { label: '', placeholder: '' },
          version: { label: '', placeholder: '' },
        },
      },
    },
    modpack: {
      title: '',
      upload: '',
      install: '',
      uninstall: '',
      version: '',
      description: '',
      noModpacks: '',
      mode: '',
      automatic: '',
      manual: '',
      loader: '',
      mcVersion: '',
      jarFileName: '',
      jarPlaceholder: '',
      jarHelp: '',
      installing: '',
      installAuto: '',
      notes: '',
      versionUnsupported: '',
      versionInfo: '',
      errorVersions: '',
    },
    whitelist: {
      title: '',
      username: '',
      usernamePlaceholder: '',
      addUser: '',
      removeUser: '',
      loading: '',
      error: '',
      noPlayers: '',
    },
    users: {
      title: '',
      createTitle: '',
      showForm: '',
      email: '',
      password: '',
      role: '',
      roleUser: '',
      roleViewer: '',
      create: '',
      creating: '',
      created: '',
      yes: '',
      no: '',
    },
  }

  // Usa le traduzioni correnti, poi fallback, poi struttura vuota
  const t = currentTranslations || fallbackTranslations || emptyTranslations

  return {
    t,
    language,
    setLanguage,
    isLoading,
  }
}
